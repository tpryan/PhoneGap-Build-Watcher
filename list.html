<!DOCTYPE html>
<html>
<head>
    <title>Build Watcher</title>
    <meta name="viewport" content="width=device-width, initial-scale=1"> 
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/bootstrap-responsive.min.css" rel="stylesheet">
    <link href="css/main.css" rel="stylesheet">
    <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>
    <script type="text/javascript" charset="utf-8" src="js/webtoolkit.base64.js"></script>
    <script type="text/javascript" charset="utf-8" src="js/main.js"></script>    
    <script type="text/javascript">

    var baseURL = "https://build.phonegap.com";
    var appApiPath = "/api/v1/apps/";
    var token = "";


    if (isInPhoneGap()){
      document.addEventListener("deviceready", init, false);
    }
    else{
      $(document).ready(init);
    }

    function init(){
      console.log("Ready");
      token = localStorage.getItem("token");
      getProjectList();
    }


    function getProjectList()
    {

      console.log("Calling the JSON");

        $.ajax({
          url: baseURL + appApiPath + "?auth_token=" + token,
          type:"get",
          success: parseRequest,
          cache:false,
          crossDomain:true
        });

    }

    function errorHandler(error){
      alert("We have a problem.");
    }

    // this function should parse responses.. you can do anything you need..
    // you can make it general so it would parse all the responses the page receives based on a response field
    function parseRequest(response)
    {
      console.log("Response coming back.");
        try // try to output this to the javascript console
        {
          
          $('#applist').html("");
          if (response.apps.length == 0){
             $('#applist').append('<li>You currently have no projects</li>');
          }


          for (var i=0; i < response.apps.length; i++){
            $('#applist').append('<li><a class="btn btn-large" href="project.html#id=' + response.apps[i].id +  '">' + response.apps[i].title + '</a></li>');
          }


        }
        catch(an_exception) // alert for the users that don't have a javascript console
        {
            alert(an_exception);
        }
    }


    </script>

</head>    
<body>

  <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
            <a class="brand" href="./index.html">PhoneGap Build Watcher</a>
            <a class="btn pull-right" href="./clear.html"><i class="icon-lock"></i> <span class="listtext">Logout</span></a>
        </div>
      </div>
    </div>

    <div class="container">
      <ul id="applist">
        <li>Getting projects <i class="icon-cog status-indicator"></i></li>
      </ul> 
    </div>

  
</body>
</html>
